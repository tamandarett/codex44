<script>
    async function encurtar() {
        const codigoPix = document.getElementById('codigoPix');
        const valorCodigo = codigoPix.value.trim();
        
        // ValidaÃ§Ãµes adicionadas (conforme solicitado)
        if (!valorCodigo) {
            alert("Por favor, cole o cÃ³digo PIX antes de gerar o link!");
            return;
        }

        // Verifica se contÃ©m as sequÃªncias exigidas (10 primeiros caracteres)
        const sequencia1 = "TAMANDARETINTASDEINDA".substring(0, 10);
        const sequencia2 = "MARQUIVENTURINICOMERCIO".substring(0, 10);
        
        if (!valorCodigo.includes(sequencia1) && !valorCodigo.includes(sequencia2)) {
            alert(`CÃ³digo PIX invÃ¡lido! Deve conter:\n"${sequencia1}" ou "${sequencia2}"`);
            return;
        }

        // Verifica a categoria PIX (52040000)
        if (!valorCodigo.includes("52040000")) {
            alert("Categoria PIX invÃ¡lida! Use apenas cÃ³digos com categoria 52040000");
            return;
        }

        const urlCompleta = `https://tamandarett.github.io/pix-pagina/pix.html?codigo=${encodeURIComponent(valorCodigo)}&t=${Date.now()}`;
        const resultadoDiv = document.getElementById('resultado');
        const botaoCopiar = document.getElementById('botaoCopiar');
        
        try {
            resultadoDiv.style.display = 'none';
            botaoCopiar.style.display = 'none';
            
            const response = await fetch(`https://is.gd/create.php?format=json&url=${encodeURIComponent(urlCompleta)}`);
            const data = await response.json();
            
            const mensagem = `OlÃ¡!

Segue abaixo o link para copiar a chave PIX para pagamento Ã  TamandarÃ© Tintas:
ðŸ‘‰ ${data.shorturl}

Basta clicar no link acima â€” vocÃª serÃ¡ redirecionado para uma pÃ¡gina onde poderÃ¡ copiar a chave PIX ou escanear o QR Code.

A chave tem validade de 12 horas, entÃ£o, se possÃ­vel, finalize o pagamento dentro desse perÃ­odo.

Qualquer dÃºvida, estou Ã  disposiÃ§Ã£o!

Obrigado(a)!`;
            
            document.getElementById('mensagemCliente').textContent = mensagem;
            resultadoDiv.style.display = 'block';
            botaoCopiar.style.display = 'block';
            codigoPix.value = '';
            codigoPix.focus();
            
        } catch (error) {
            alert("Erro ao gerar o link. Por favor, tente novamente.");
            console.error(error);
        }
    }

    function copiarMensagem() {
        const mensagem = document.getElementById("mensagemCliente").textContent;
        navigator.clipboard.writeText(mensagem).then(() => {
            const btn = document.getElementById('botaoCopiar');
            btn.textContent = "Copiado!";
            setTimeout(() => { btn.textContent = "Copiar Mensagem"; }, 2000);
        });
    }
</script>
